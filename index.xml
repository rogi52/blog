<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Home on rogi52</title><link>https://rogi52.github.io/blog/</link><description>Recent content in Home on rogi52</description><generator>Hugo -- gohugo.io</generator><language>ja</language><lastBuildDate>Wed, 21 Jan 2026 15:45:53 +0000</lastBuildDate><atom:link href="https://rogi52.github.io/blog/index.xml" rel="self" type="application/rss+xml"/><item><title>AGC005-D ~K Perm Counting $O(N \log N)$ 時間解法</title><link>https://rogi52.github.io/blog/posts/agc005-d/</link><pubDate>Wed, 21 Jan 2026 22:56:00 +0900</pubDate><guid>https://rogi52.github.io/blog/posts/agc005-d/</guid><description>&lt;ul&gt;
&lt;li&gt;&lt;a class="link" href="#%e6%a6%82%e8%a6%81" &gt;概要&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="#%e5%86%85%e5%ae%b9" &gt;内容&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class="link" href="#%e3%83%91%e3%82%b9%e3%82%b0%e3%83%a9%e3%83%95%e5%8d%98%e4%bd%93" &gt;パスグラフ単体&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="#%e3%82%b0%e3%83%a9%e3%83%95%e5%85%a8%e4%bd%93" &gt;グラフ全体&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="#%e8%a8%88%e7%ae%97%e9%87%8f" &gt;計算量&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="#%e6%84%9f%e6%83%b3" &gt;感想&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="概要"&gt;概要
&lt;/h2&gt;&lt;p&gt;&lt;a class="link" href="https://atcoder.jp/contests/agc005/tasks/agc005_d" target="_blank" rel="noopener"
&gt;AGC005 D ~K Perm Counting&lt;/a&gt;
を $O(N \log N)$ 時間で解く方法を解説します．
公式解説で「おまけ」として言及されている解法です．&lt;/p&gt;
&lt;h2 id="内容"&gt;内容
&lt;/h2&gt;&lt;p&gt;公式解説と同様に，問題を「$2N$ 個の頂点からなる二部グラフのマッチング問題」として整理します．
グラフの各連結成分はパスグラフになります．
したがって，問題は「パスグラフの集合から合計 $A$ 本の辺を，マッチングとなる (端点を共有しない) ように選ぶ方法の数」を $A = 0, 1, \dots, N$ について求めることに帰着されます．&lt;/p&gt;
&lt;h3 id="パスグラフ単体"&gt;パスグラフ単体
&lt;/h3&gt;&lt;p&gt;頂点数 $n$ のパスグラフにおいて，マッチングとなるように $i$ 本の辺を選ぶ方法の数を考えます．
隣り合う辺は端点を共有するため， $(n-1)$ 本の辺から $i$ 本の辺を「連続しないように」選ぶ方法の数と等しくなります．&lt;/p&gt;
&lt;p&gt;$1$ 列に並んだ $(n-1)$ 個の玉から，連続しないように $i$ 個選ぶ方法は，
「選ばない $(n-1-i)$ 個の玉を並べ，その隙間と両端の計 $(n-i)$ 箇所から，選ぶ玉を置く $i$ 箇所を選ぶ」と考えれば，その総数は $\binom{n-i}{i}$ 通りです．
これを母関数として表すと次のようになります．
$$ F_n(x) \coloneqq \sum_i \binom{n-i}{i} x^i $$&lt;/p&gt;
&lt;h3 id="グラフ全体"&gt;グラフ全体
&lt;/h3&gt;&lt;p&gt;パスグラフの頂点数としてあり得るのは，$\left\lfloor \frac{N}{K} \right\rfloor$ または $\left\lceil \frac{N}{K} \right\rceil$ です．
これらを $n_1, n_2$ とし，それぞれのパスグラフの個数を $c_1, c_2$ とします
（$N$ が $K$ で割り切れるときは，例えば $c_1 = 2K$，$c_2 = 0$ とすれば良いです）．
合計 $A$ 本の辺を選ぶ方法の数は，
$$ [x^A] \bigl( F_{n_1}(x) \bigr)^{c_1} \bigl( F_{n_2}(x) \bigr)^{c_2} $$
と表せます．
よって，多項式 $\bigl( F_{n_1}(x) \bigr)^{c_1} \bigl( F_{n_2}(x) \bigr)^{c_2}$ を計算すればよいです．&lt;/p&gt;
&lt;h3 id="計算量"&gt;計算量
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;$F_{n}(x)$ は，二項係数を前計算しておくことで $O(N)$ 時間で計算できます．&lt;/li&gt;
&lt;li&gt;$\bigl( F_{n}(x) \bigr)^{c}$ は，&lt;a class="link" href="https://judge.yosupo.jp/problem/pow_of_formal_power_series" target="_blank" rel="noopener"
&gt;FPS の pow&lt;/a&gt; を使うことで $O(N \log N)$ 時間で計算できます．&lt;/li&gt;
&lt;li&gt;$2$ つの多項式を FFT で掛け合わせれば $O(N \log N)$ 時間です．&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;よって，全体で $O(N \log N)$ 時間です．&lt;/p&gt;
&lt;h2 id="感想"&gt;感想
&lt;/h2&gt;&lt;p&gt;個数系包除原理と FPS は相性がいいですね．
シンプルな問題設定ながら，FPS の典型テクも適用できる，教育的で面白い問題でした．&lt;/p&gt;</description></item></channel></rss>